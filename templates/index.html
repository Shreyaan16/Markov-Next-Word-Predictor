<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; padding: 20px; max-width: 900px; margin: auto; background-color: #f9f9f9; }
        nav { background-color: #fff; border-radius: 8px; padding: 10px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
        nav a { font-weight: 600; text-decoration: none; color: #007aff; padding: 8px 12px; }
        nav a.active { background-color: #eef5ff; border-radius: 6px; }
        .container { background-color: #fff; border-radius: 8px; padding: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h1 { color: #333; }
        textarea { width: 95%; height: 100px; font-family: monospace; font-size: 14px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        button { background-color: #007aff; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        #results, #generated { margin-top: 20px; background-color: #f4f4f4; padding: 20px; border-radius: 6px; }
        #results h3, #generated h3 { margin-top: 0; }
        #predictions-list { list-style: none; padding-left: 0; }
        #predictions-list li { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        #predictions-list li span:first-child { font-weight: 600; }
        #generated-text { font-style: italic; color: #333; }
    </style>
</head>
<body>
    <nav>
        <a href="/" class="active">ðŸš€ Predictor App</a>
        <a href="/dashboard">ðŸ“Š Analysis Dashboard</a>
    </nav>

    <div class="container">
        <h1>Next-Word Predictor (Order-{{ model_order }})</h1>
        <p>Type a sentence and see the model's top 5 predictions for the next word. (Note: For order {{ model_order }}, you need at least {{ model_order }} words for a prediction).</p>

        <textarea id="context" placeholder="Type your text here, e.g., 'machine learning is'">machine learning is</textarea>
        <br>
        <button id="predict-btn">Predict Next Word</button>

        <div id="results" style="display: none;">
            <h3>Top 5 Predictions:</h3>
            <ul id="predictions-list"></ul>
        </div>

        <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

        <h2>Text Generation</h2>
        <p>Generate a block of text from the model.</p>
        <button id="generate-btn">Generate 50 Words</button>
        <div id="generated" style="display: none;">
            <h3>Generated Text:</h3>
            <p id="generated-text"></p>
        </div>
    </div>

    <script>
        document.getElementById('predict-btn').addEventListener('click', async () => {
            const context = document.getElementById('context').value;
            const response = await fetch('/api/predict', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ context: context })
            });
            const data = await response.json();
            
            const resultsDiv = document.getElementById('results');
            const list = document.getElementById('predictions-list');
            list.innerHTML = ''; // Clear old results

            if (data.success && data.predictions.length > 0) {
                data.predictions.forEach(pred => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${pred[0]}</span> <span>(${(pred[1] * 100).toFixed(2)}%)</span>`;
                    list.appendChild(li);
                });
                resultsDiv.style.display = 'block';
            } else {
                list.innerHTML = '<li>No predictions found for this context. (Note: Order-{{ model_order }} model needs {{ model_order }} words of context).</li>';
                resultsDiv.style.display = 'block';
            }
        });

        document.getElementById('generate-btn').addEventListener('click', async () => {
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.innerText = 'Generating...';

            const response = await fetch('/api/generate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ length: 50 })
            });
            const data = await response.json();
            
            const generatedDiv = document.getElementById('generated');
            const p = document.getElementById('generated-text');

            if (data.success) {
                p.innerText = data.text;
                generatedDiv.style.display = 'block';
            } else {
                p.innerText = 'Error generating text.';
                generatedDiv.style.display = 'block';
            }
            btn.disabled = false;
            btn.innerText = 'Generate 50 Words';
        });
    </script>
</body>
</html>